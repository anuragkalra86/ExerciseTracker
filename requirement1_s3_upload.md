# Requirement 1: S3 Upload Functionality

## Overview
Upload local MP4 files generated by `motion_record.py` to S3 bucket and delete them from local storage after successful upload.

## Key Constraints
- **Non-blocking**: Recording should not wait for S3 upload (asynchronous operation)
- **No real-time requirement**: File upload doesn't need to happen immediately
- **Automatic cleanup**: Local files should be deleted after successful upload
- **No modification to existing recorder**: Keep `motion_record.py` unchanged

## Design Options Evaluated

### Option 1: File System Watcher ⭐ **RECOMMENDED**
**Implementation**: Separate Python script using `watchdog` library to monitor clips directory

**Pros:**
- Event-driven architecture (no polling overhead)
- Completely decoupled from recording process
- Automatic trigger when new files are created
- No modification needed to existing `motion_record.py`
- Real-time responsiveness

**Cons:**
- Slightly more complex implementation
- Need to handle file system event edge cases

**Technical Details:**
- Monitor `/home/orange/gym/videos/` directory
- React to file creation events for `.mp4` files
- Wait for file write completion before upload
- Handle upload failures with retry logic

### Option 2: Timer-based Polling
**Implementation**: Separate Python script running on intervals (e.g., every 30 seconds)

**Pros:**
- Simple to implement and understand
- Reliable and predictable
- Easy to debug and maintain

**Cons:**
- Unnecessary checks when no files exist
- Slight delay between file creation and upload
- Resource waste from constant polling

### Option 3: Queue-based Approach
**Implementation**: Motion recorder adds file paths to queue, uploader consumes from queue

**Pros:**
- Highly reliable with failure handling
- Can handle upload failures gracefully
- Decoupled architecture

**Cons:**
- Requires additional infrastructure (Redis, database, etc.)
- More complex setup and maintenance
- Overkill for single-machine deployment

## Recommended Architecture

```
Motion Recorder (existing)
    ↓ (writes files)
Local MP4 Files (/home/orange/gym/videos/)
    ↓ (file system events)
File System Watcher (new script)
    ↓ (uploads)
S3 Bucket
    ↓ (cleanup after success)
Delete Local Files
```

## Implementation Plan

### Components to Create:
1. **`s3_uploader.py`**: Main upload daemon
2. **Configuration file**: AWS credentials and S3 bucket details
3. **Logging**: Comprehensive logging for monitoring
4. **Error handling**: Retry logic and failure notifications

### Key Features:
- **Automatic startup**: Run as daemon/service
- **Failure handling**: Retry failed uploads with exponential backoff
- **Logging**: Track all upload activities and errors
- **Configuration**: External config for S3 bucket, AWS credentials
- **Safety checks**: Verify file upload before local deletion

## Technical Requirements

### Dependencies:
- `boto3`: AWS SDK for Python
- `watchdog`: File system event monitoring
- `configparser`: Configuration management

### AWS Setup:
- S3 bucket with appropriate permissions
- IAM user/role with S3 write permissions
- AWS credentials configuration

### Error Scenarios to Handle:
- Network connectivity issues
- AWS authentication failures
- S3 upload failures
- Local file deletion failures
- File system permission issues

## Deployment Strategy
- Run `s3_uploader.py` as a background service
- Use systemd service file for automatic startup
- Monitor logs for upload status and errors
- Keep `motion_record.py` unchanged and independent

## Success Metrics
- All MP4 files successfully uploaded to S3
- Local files cleaned up after successful upload
- No impact on motion recording performance
- Reliable error handling and logging 